# 格挡系统测试指南

## 测试目的
验证三种格挡系统是否正常工作：普通格挡、完美格挡、多重反击

---

## 测试 1: 普通格挡 ✅

### 操作步骤
1. 启动游戏
2. 等待敌人出现（远程或近战）
3. **长按空格键**进行格挡
4. 等待敌人攻击命中

### 预期结果
- ✅ 青色护盾出现
- ✅ 格挡成功，敌人攻击被挡下
- ✅ **自动瞬移到最近的敌人并击杀**
- ✅ 青色刀光轨迹
- ✅ 中等屏幕震动
- ✅ 时间减速（0.3倍速）

### 关键点
- **普通格挡也会触发反击**
- 只要格挡成功，就会自动反击最近的敌人

---

## 测试 2: 完美格挡 ⭐

### 操作步骤
1. 格挡第一个敌人攻击（普通格挡）
2. **立即**（100ms内）格挡第二个敌人攻击
3. 观察效果

### 预期结果
- ✅ **金色闪光**（而不是青色）
- ✅ 格挡成功
- ✅ **自动瞬移反击**
- ✅ 金色刀光轨迹
- ✅ 更强的屏幕震动
- ✅ 更慢的时间（0.1倍速）
- ✅ 飘字显示 "PERFECT!"
- ✅ **额外能量恢复 +10**

### 关键点
- 需要连续两次格挡，时间间隔 < 100ms
- 完美格挡也会触发反击
- 额外能量奖励

---

## 测试 3: 多重反击 ⚡

### 操作步骤
1. 观察敌人即将攻击
2. **在攻击命中前的瞬间**（150ms内）按下空格键
3. 确保周围有3个以上敌人

### 预期结果
- ✅ **紫色闪光**（最强）
- ✅ 格挡成功
- ✅ **连续瞬移反击3个敌人**
- ✅ 紫色刀光轨迹
- ✅ 超强屏幕震动
- ✅ 极慢时间（0.05倍速）
- ✅ 飘字显示 "MULTI COUNTER x3!"
- ✅ **大量能量恢复 +20基础**
- ✅ 紫色冲击波

### 关键点
- 需要精准时机：按键到格挡成功 < 150ms
- 最佳时机：近战敌人警告结束瞬间
- 会连续击杀多个敌人

---

## 测试场景对比

### 场景 1: 单个远程敌人
```
操作：长按空格 → 子弹命中
结果：普通格挡 → 瞬移反击 → 击杀敌人
```

### 场景 2: 两个远程敌人（快速连续）
```
操作：格挡第一个 → 立即格挡第二个（<100ms）
结果：第二次触发完美格挡 → 金色特效 → 额外能量
```

### 场景 3: 多个敌人围攻
```
操作：观察近战敌人警告 → 警告结束瞬间按空格
结果：多重反击 → 紫色特效 → 连续击杀3个敌人
```

---

## 常见问题排查

### 问题 1: 普通格挡没有反击
**可能原因**:
- 格挡时已经在反击状态
- 没有敌人存在
- 能量不足，格挡失败

**解决方法**:
- 等待反击完成后再格挡
- 确保有敌人存在
- 保持能量充足

### 问题 2: 完美格挡没有触发
**可能原因**:
- 两次格挡间隔太长（>100ms）
- 第一次格挡时间太久之前

**解决方法**:
- 快速连续格挡两次
- 确保时间间隔 < 100ms

### 问题 3: 多重反击没有触发
**可能原因**:
- 按键太早（提前按下空格）
- 按键太晚（攻击已经命中）
- 时间窗口太短（>150ms）

**解决方法**:
- 观察敌人攻击动画
- 在攻击即将命中时按键
- 可以调整 config.json 中的 timeWindow

---

## 视觉效果对比表

| 特性 | 普通格挡 | 完美格挡 | 多重反击 |
|------|---------|---------|---------|
| 护盾颜色 | 青色 | 青色 | 青色 |
| 闪光颜色 | 青色 | **金色** | **紫色** |
| 刀光颜色 | 青色→白→金 | 青色→白→金 | **紫色→白** |
| 震动强度 | 8 | 12 | **20** |
| 时间减速 | 0.3x | 0.1x | **0.05x** |
| 反击次数 | 1 | 1 | **3** |
| 能量奖励 | 击杀+18 | +10 + 击杀+18 | **+20 + 击杀×3** |
| 飘字提示 | KILL! | PERFECT! | **MULTI COUNTER x3!** |

---

## 配置调整（可选）

如果觉得多重反击太难触发，可以调整配置：

### 降低难度
编辑 `config.json`:
```json
"multiCounter": {
  "timeWindow": 200,  // 从150增加到200ms
  "maxTargets": 4     // 从3增加到4个目标
}
```

### 提高难度
```json
"multiCounter": {
  "timeWindow": 100,  // 从150减少到100ms
  "maxTargets": 2     // 从3减少到2个目标
}
```

---

## 测试检查清单

- [ ] 普通格挡能触发反击
- [ ] 完美格挡有金色特效
- [ ] 完美格挡能触发反击
- [ ] 完美格挡有额外能量
- [ ] 多重反击有紫色特效
- [ ] 多重反击能连续击杀3个敌人
- [ ] 多重反击有大量能量恢复
- [ ] 所有格挡的刀光颜色正确
- [ ] 所有格挡的音效正常
- [ ] 帧率保持稳定（60fps）

---

**测试版本**: v2.5  
**更新日期**: 2025-12-15
