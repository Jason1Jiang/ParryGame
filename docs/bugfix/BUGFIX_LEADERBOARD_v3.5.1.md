# æ’è¡Œæ¦œ Bug ä¿®å¤ v3.5.1

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**: 
- æ’è¡Œæ¦œæ˜¾ç¤º 0 æ¡è®°å½•
- æ§åˆ¶å°æ˜¾ç¤º "Loaded 0 records"
- Firebase è­¦å‘Š "Using an unspecified index"

**å½±å“**: 
- æ— æ³•çœ‹åˆ°æäº¤çš„åˆ†æ•°
- æ’è¡Œæ¦œåŠŸèƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨

## ğŸ” é—®é¢˜åŸå› 

### 1. å‚æ•°é¡ºåºé”™è¯¯ âœ… å·²ä¿®å¤
**ä½ç½®**: `game.js` ç¬¬ 2602 è¡Œ

**é”™è¯¯ä»£ç **:
```javascript
await leaderboard.submitScore(selectedDifficulty, playerName, kills, gameTime);
```

**é—®é¢˜**: 
- ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥æ˜¯ `playerName`ï¼Œä½†ä¼ å…¥äº† `selectedDifficulty`
- å¯¼è‡´æ•°æ®å†™å…¥é”™è¯¯çš„ä½ç½®æˆ–æ ¼å¼ä¸æ­£ç¡®

**æ­£ç¡®ä»£ç **:
```javascript
await leaderboard.submitScore(playerName, kills, gameTime, selectedDifficulty);
```

**å‡½æ•°ç­¾å**:
```javascript
submitScore(playerName, kills, survivalTime, difficulty)
```

### 2. å­—æ®µåé”™è¯¯ âœ… å·²ä¿®å¤
**ä½ç½®**: `game.js` ç¬¬ 2676 è¡Œ

**é”™è¯¯ä»£ç **:
```javascript
<td>${record.time}s</td>
```

**é—®é¢˜**: 
- æ•°æ®åº“ä¸­å­˜å‚¨çš„å­—æ®µåæ˜¯ `survivalTime`
- ä½†æ˜¾ç¤ºæ—¶ä½¿ç”¨äº† `record.time`
- å¯¼è‡´æ˜¾ç¤º "undefineds"

**æ­£ç¡®ä»£ç **:
```javascript
<td>${record.survivalTime}s</td>
```

### 3. Firebase ç´¢å¼•ç¼ºå¤± âš ï¸ éœ€è¦æ‰‹åŠ¨é…ç½®
**é—®é¢˜**: 
- Firebase æ•°æ®åº“è§„åˆ™ä¸­æ²¡æœ‰é…ç½®ç´¢å¼•
- å¯¼è‡´æŸ¥è¯¢æ€§èƒ½è­¦å‘Š

**è§£å†³æ–¹æ¡ˆ**: 
- éœ€è¦åœ¨ Firebase æ§åˆ¶å°æ‰‹åŠ¨é…ç½®æ•°æ®åº“è§„åˆ™
- è¯¦è§ `FIREBASE_SETUP_GUIDE.md`

## âœ… ä¿®å¤å†…å®¹

### ä»£ç ä¿®å¤
- [x] ä¿®æ­£ `game.js` ä¸­ `submitScore` çš„å‚æ•°é¡ºåº
- [x] ä¿®æ­£ `game.js` ä¸­ `displayLeaderboard` çš„å­—æ®µåï¼ˆtime â†’ survivalTimeï¼‰
- [x] æ·»åŠ å‚æ•°è¯´æ˜æ³¨é‡Š

### æ–°å¢æ–‡ä»¶
- [x] `firebase-database-rules.json` - æ•°æ®åº“è§„åˆ™é…ç½®æ–‡ä»¶
- [x] `FIREBASE_SETUP_GUIDE.md` - Firebase é…ç½®è¯¦ç»†æŒ‡å—
- [x] `BUGFIX_LEADERBOARD_v3.5.1.md` - æœ¬ä¿®å¤è¯´æ˜æ–‡æ¡£

### æ–‡æ¡£æ›´æ–°
- [x] æ›´æ–° `LEADERBOARD_COMPLETE_v3.5.md` æ·»åŠ é…ç½®è¯´æ˜

## ğŸš€ ä¿®å¤åçš„æ“ä½œæ­¥éª¤

### æ­¥éª¤ 1: é…ç½® Firebase æ•°æ®åº“è§„åˆ™ï¼ˆå¿…é¡»ï¼‰

1. **è®¿é—® Firebase æ§åˆ¶å°**
   ```
   https://console.firebase.google.com/
   ```

2. **é€‰æ‹©é¡¹ç›®**
   - é¡¹ç›®: `bladeecho-d4cd3`

3. **é…ç½®è§„åˆ™**
   - è¿›å…¥ **Realtime Database** > **è§„åˆ™**
   - å¤åˆ¶ `firebase-database-rules.json` ä¸­çš„å†…å®¹
   - ç²˜è´´åˆ°è§„åˆ™ç¼–è¾‘å™¨
   - ç‚¹å‡» **å‘å¸ƒ**

4. **ç­‰å¾…ç”Ÿæ•ˆ**
   - è§„åˆ™å‘å¸ƒåéœ€è¦å‡ ç§’é’Ÿç”Ÿæ•ˆ
   - åˆ·æ–°é¡µé¢åé‡è¯•

### æ­¥éª¤ 2: æ¸…é™¤æµè§ˆå™¨ç¼“å­˜

1. æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
2. å³é”®ç‚¹å‡»åˆ·æ–°æŒ‰é’®
3. é€‰æ‹© "æ¸…ç©ºç¼“å­˜å¹¶ç¡¬æ€§é‡æ–°åŠ è½½"

### æ­¥éª¤ 3: æµ‹è¯•åŠŸèƒ½

1. **æµ‹è¯•æäº¤åˆ†æ•°**
   ```
   1. å¼€å§‹æ¸¸æˆ
   2. æ¸¸æˆç»“æŸåè¾“å…¥åå­—
   3. ç‚¹å‡»"æäº¤"
   4. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰ "åˆ†æ•°æäº¤æˆåŠŸ" æ¶ˆæ¯
   ```

2. **éªŒè¯ Firebase æ•°æ®**
   ```
   1. æ‰“å¼€ Firebase æ§åˆ¶å°
   2. è¿›å…¥ Realtime Database > æ•°æ®
   3. æŸ¥çœ‹ leaderboard/{difficulty} ä¸‹æ˜¯å¦æœ‰è®°å½•
   ```

3. **æµ‹è¯•æ’è¡Œæ¦œæ˜¾ç¤º**
   ```
   1. ä¸»èœå•ç‚¹å‡» "RANKS"
   2. åº”è¯¥èƒ½çœ‹åˆ°åˆšæ‰æäº¤çš„åˆ†æ•°
   3. åˆ‡æ¢éš¾åº¦æ ‡ç­¾æµ‹è¯•
   ```

## ğŸ“Š é¢„æœŸç»“æœ

### æäº¤åˆ†æ•°å
- æ§åˆ¶å°æ˜¾ç¤º: `åˆ†æ•°æäº¤æˆåŠŸï¼`
- Firebase æ§åˆ¶å°èƒ½çœ‹åˆ°æ–°è®°å½•
- è®°å½•æ ¼å¼æ­£ç¡®:
  ```json
  {
    "playerName": "ç©å®¶å",
    "kills": 50,
    "survivalTime": 120,
    "score": 5120,
    "difficulty": "hardcore",
    "timestamp": 1702999999999
  }
  ```

### æŸ¥çœ‹æ’è¡Œæ¦œ
- æ§åˆ¶å°æ˜¾ç¤º: `Loaded X records for {difficulty}`ï¼ˆX > 0ï¼‰
- æ’è¡Œæ¦œè¡¨æ ¼æ˜¾ç¤ºè®°å½•
- å‰ä¸‰åæ˜¾ç¤ºå¥–ç‰Œå›¾æ ‡
- æ—  Firebase è­¦å‘Š

## ğŸ” é—®é¢˜æ’æŸ¥

### å¦‚æœä»ç„¶æ˜¾ç¤º 0 æ¡è®°å½•

1. **æ£€æŸ¥ Firebase è§„åˆ™**
   - ç¡®è®¤è§„åˆ™å·²å‘å¸ƒ
   - ç¡®è®¤ `.read` å’Œ `.write` éƒ½æ˜¯ `true`

2. **æ£€æŸ¥æ•°æ®åº“è·¯å¾„**
   - è·¯å¾„åº”è¯¥æ˜¯ `leaderboard/{difficulty}`ï¼ˆå•æ•°ï¼‰
   - ä¸æ˜¯ `leaderboards/{difficulty}`ï¼ˆå¤æ•°ï¼‰

3. **æ£€æŸ¥æ•°æ®æ ¼å¼**
   - æ¯æ¡è®°å½•å¿…é¡»åŒ…å«æ‰€æœ‰å¿…éœ€å­—æ®µ
   - `score` å­—æ®µå¿…é¡»å­˜åœ¨ï¼ˆç”¨äºæ’åºï¼‰

4. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   - æ§åˆ¶å°åº”æ˜¾ç¤º "Connection status: Online"
   - å¦‚æœæ˜¾ç¤º Offlineï¼Œæ£€æŸ¥ç½‘ç»œ

### å¦‚æœä»ç„¶æœ‰ç´¢å¼•è­¦å‘Š

1. **ç¡®è®¤ç´¢å¼•é…ç½®**
   - è§„åˆ™ä¸­å¿…é¡»åŒ…å« `.indexOn` é…ç½®
   - ç´¢å¼•å­—æ®µ: `["score", "kills", "survivalTime"]`

2. **ç­‰å¾…ç”Ÿæ•ˆ**
   - ç´¢å¼•é…ç½®éœ€è¦å‡ åˆ†é’Ÿç”Ÿæ•ˆ
   - åˆ·æ–°é¡µé¢é‡è¯•

3. **æ¸…é™¤ç¼“å­˜**
   - æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
   - é‡æ–°åŠ è½½é¡µé¢

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### å‚æ•°é¡ºåºå¯¹æ¯”

**é”™è¯¯** âŒ:
```javascript
submitScore(difficulty, playerName, kills, time)
// å®é™…è°ƒç”¨: submitScore('hardcore', 'ç©å®¶1', 50, 120)
```

**æ­£ç¡®** âœ…:
```javascript
submitScore(playerName, kills, time, difficulty)
// å®é™…è°ƒç”¨: submitScore('ç©å®¶1', 50, 120, 'hardcore')
```

### æ•°æ®åº“è·¯å¾„

**ä½¿ç”¨çš„è·¯å¾„**:
```
leaderboard/
  â”œâ”€â”€ hardcore/
  â”‚   â””â”€â”€ {recordId}
  â”œâ”€â”€ balanced/
  â”‚   â””â”€â”€ {recordId}
  â””â”€â”€ casual/
      â””â”€â”€ {recordId}
```

**æ³¨æ„**: æ˜¯ `leaderboard`ï¼ˆå•æ•°ï¼‰ï¼Œä¸æ˜¯ `leaderboards`ï¼ˆå¤æ•°ï¼‰

### åˆ†æ•°è®¡ç®—

```javascript
score = kills * 100 + survivalTime
```

**æ’åºè§„åˆ™**:
1. æŒ‰ `score` é™åºæ’åˆ—
2. `score` ç›¸åŒæ—¶ï¼Œå…ˆæäº¤çš„æ’å‰é¢

## ğŸ¯ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬**: v3.5.1
- **ä¿®å¤æ—¥æœŸ**: 2024-12-19
- **ä¿®å¤ç±»å‹**: Bug ä¿®å¤
- **å½±å“èŒƒå›´**: æ’è¡Œæ¦œåŠŸèƒ½

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `FIREBASE_SETUP_GUIDE.md` - Firebase é…ç½®è¯¦ç»†æŒ‡å—
- `firebase-database-rules.json` - æ•°æ®åº“è§„åˆ™é…ç½®
- `LEADERBOARD_COMPLETE_v3.5.md` - å®Œæ•´å®ç°æ–‡æ¡£
- `CHANGELOG_v3.5.md` - ç‰ˆæœ¬æ›´æ–°æ—¥å¿—

## âœ… ä¿®å¤ç¡®è®¤æ¸…å•

å®Œæˆä»¥ä¸‹æ­¥éª¤ç¡®è®¤ä¿®å¤æˆåŠŸï¼š

- [ ] ä»£ç å·²æ›´æ–°ï¼ˆgame.js å‚æ•°é¡ºåºï¼‰
- [ ] Firebase è§„åˆ™å·²é…ç½®
- [ ] è§„åˆ™å·²å‘å¸ƒç”Ÿæ•ˆ
- [ ] æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤
- [ ] æµ‹è¯•æäº¤åˆ†æ•°æˆåŠŸ
- [ ] Firebase æ§åˆ¶å°èƒ½çœ‹åˆ°æ•°æ®
- [ ] æ’è¡Œæ¦œèƒ½æ­£å¸¸æ˜¾ç¤ºè®°å½•
- [ ] æ§åˆ¶å°æ— é”™è¯¯
- [ ] æ§åˆ¶å°æ— ç´¢å¼•è­¦å‘Š

## ğŸ‰ å®Œæˆ

ä¿®å¤å®Œæˆåï¼Œæ’è¡Œæ¦œç³»ç»Ÿåº”è¯¥èƒ½å®Œå…¨æ­£å¸¸å·¥ä½œäº†ï¼

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒ `FIREBASE_SETUP_GUIDE.md` è·å–è¯¦ç»†çš„é…ç½®å’Œæ’æŸ¥æ­¥éª¤ã€‚
